#include <iostream>
#include <filesystem>
#include <fstream>
#include <string>

namespace fs = std::filesystem;

// Helper to check if filename ends with substring
bool endsWith(const std::string& str, const std::string& suffix) {
    if (suffix.size() > str.size()) return false;
    return std::equal(suffix.rbegin(), suffix.rend(), str.rbegin());
}

// Helper to check if filename contains substring
bool contains(const std::string& str, const std::string& substr) {
    return str.find(substr) != std::string::npos;
}

int main() {
    std::string sourceDir, destDir, pattern;
    char mode;
    std::cout << "Enter source directory path: ";
    std::cin >> sourceDir;
    std::cout << "Enter destination directory path: ";
    std::cin >> destDir;
    std::cout << "Enter the substring to match: ";
    std::cin >> pattern;
    std::cout << "Should we match (e)nding or (c)ontaining the substring? (e/c): ";
    std::cin >> mode;

    try {
        fs::create_directories(destDir);
        for (const auto& entry : fs::directory_iterator(sourceDir)) {
            auto name = entry.path().filename().string();
            bool match = false;
            if (mode == 'e') match = endsWith(name, pattern);
            if (mode == 'c') match = contains(name, pattern);

            if (fs::is_regular_file(entry.path()) && match) {
                fs::path destFile = fs::path(destDir) / name;
                fs::copy_file(entry.path(), destFile, fs::copy_options::skip_existing);
                std::cout << "Copied " << entry.path() << " to " << destFile << std::endl;
            }
        }
    } catch (const fs::filesystem_error& e) {
        std::cerr << "Filesystem error: " << e.what() << std::endl;
    } catch (...) {
        std::cerr << "Unknown error occurred." << std::endl;
    }
    return 0;
}
